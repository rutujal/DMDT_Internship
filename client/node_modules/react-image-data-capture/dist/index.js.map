{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import React, { Fragment } from 'react';\nimport { useState, useEffect, useRef } from 'react';\nimport { createRef, useCallback } from 'react';\n\nconst imageContainer = {\n    position: 'relative',\n    display: 'inline-block'\n};\nconst imageCanvas = {\n    display: 'none'\n};\nconst captureBtn = {\n    border: '1px solid white',\n    borderRadius: '50%',\n    width: '50px',\n    height: '50px',\n    background: '#f7473587',\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    transform: 'translate(-50%, -50%)',\n    cursor: 'pointer'\n}\n\nfunction ImageCapture(props) {\n    const { onCapture, onError, width, userMediaConfig } = props;\n    const [streaming, setStreaming] = useState(false);\n    const playerRef = createRef();\n    const canvasRef = createRef();\n    const tracks = useRef();\n    useEffect(() => {\n        let timeout;\n        navigator.mediaDevices\n            .getUserMedia(userMediaConfig)\n            .then((stream) => {\n                playerRef.current.srcObject = stream;\n                tracks.current = stream.getTracks();\n                timeout = setTimeout(() => setStreaming(true), 2000);\n            }).catch(error => {\n                if (onError) onError(error);\n            });\n        return () => {\n            if (timeout) clearTimeout(timeout);\n        };\n    }, [onError, userMediaConfig]);\n\n    useEffect(() => {\n        return () => {\n            // Stop the camera stream\n            if (tracks.current) {\n                tracks.current[0].stop();\n            }\n        };\n    }, []);\n\n    const captureImage = useCallback(() => {\n        const imageWidth = playerRef.current.offsetWidth;\n        const imageHeight = playerRef.current.offsetHeight;\n        [canvasRef.current.width, canvasRef.current.height] = [imageWidth, imageHeight];\n        const context = canvasRef.current.getContext('2d');\n        context.drawImage(playerRef.current, 0, 0, imageWidth, imageHeight);\n        // Trigger the callback function\n        if (onCapture) {\n            const webPData = canvasRef.current.toDataURL('image/webp');\n            canvasRef.current.toBlob((blob) => {\n                onCapture({ blob, webP: webPData, file: new File([webPData], `${new Date().getTime()}.png`) });\n            });\n        }\n    }, [onCapture, canvasRef, playerRef]);\n\n    return (\n        <div style={imageContainer}>\n            <video ref={playerRef} autoPlay width={width}></video>\n            {streaming &&\n                <Fragment>\n                    <div style={captureBtn} onClick={captureImage} />\n                    <canvas style={imageCanvas} ref={canvasRef} />\n                </Fragment>\n            }\n        </div>\n    );\n}\n\nexport default ImageCapture;\n"],"names":["imageContainer","position","display","imageCanvas","captureBtn","border","borderRadius","width","height","background","top","left","transform","cursor","ImageCapture","props","onCapture","onError","userMediaConfig","useState","streaming","setStreaming","playerRef","createRef","canvasRef","tracks","useRef","useEffect","timeout","navigator","mediaDevices","getUserMedia","then","stream","current","srcObject","getTracks","setTimeout","error","clearTimeout","stop","captureImage","useCallback","imageWidth","offsetWidth","imageHeight","offsetHeight","context","getContext","drawImage","webPData","toDataURL","toBlob","blob","webP","file","File","Date","getTime","React","Fragment"],"mappings":"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"}